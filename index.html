<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Entrainement conversion bianire/décimal</title>
    <style>
        body {
            font-family: sans-serif;
            font-size: 24pt;}
        input {
            font-size: 24pt;}
        input[type=number] { 
            -moz-appearance: textfield;
            appearance: textfield;
            height: 50px;
            width: 150px;
            margin: 4px;
            text-align: center}
        input::-webkit-inner-spin-button,
        input::-webkit-outer-spin-button { 
            -webkit-appearance: none;
            margin:0;}
        input::-o-inner-spin-button,
        input::-o-outer-spin-button { 
            -o-appearance: none;
            margin:0;}
        input[type=button] {
            margin-right: 5px;
        }
        span.math{
            font-size: 30pt;
            white-space: nowrap;}
        span.aDroite{
            float: right;}
        div.correction{
            text-align: center;
            margin-top: 20px;
            color: blue;}
        div.soustractions {
            margin: auto;
            width: 300px;
            text-align: left;}
        table {
            border-collapse: collapse;
            margin: auto;}
        td {
            border:1px solid black;
            vertical-align: middle;
            text-align: center;
            width: 120px;}
    </style>
</head>

<body>
    <div id="container">
    </div>
    <script language="javascript">
        
        liste_questions = [
            () => {
                const fieldset = document.createElement("fieldset");
                const legend = document.createElement("legend");
                const form = document.createElement("form");
                fieldset.appendChild(legend);
                fieldset.appendChild(form);
                legend.textContent = "décimal vers binaire";
                form.base10 = Math.floor(5 + Math.random() * Math.floor(250));
                form.base2 = form.base10.toString(2) ;
                form.sujet = `Convertir en base 2 l'entier naturel (${form.base10})<sub>10</sub> écrit en base 10.`
                form.innerHTML = `
                    <label name="question">${form.sujet}</label>
                    <input type="number" name="rep"></input>
                    <input type="submit" value="Vérifier"/>
                    <label></label>
                    <div class="correction" name="correction"><span class="aDroite"><input type="button" value="Correction"/></span></div>
                `;
                soustractions = (n, p) => {
                    if (n == 0) {return ""}
                    if (Math.pow(2, p) > n) {return soustractions(n, p-1)}
                    return `${n} - ${Math.pow(2, p)} = ${n-Math.pow(2, p)} <br/> ${soustractions(n-Math.pow(2, p), p-1)}`
                }
                form.handleEvent = (event) => {
                    if (event.target.type == "submit") {
                        event.preventDefault()
                        const entry = event.target.previousElementSibling
                        const label = event.target.nextElementSibling
                        const form = entry.parentNode
                        label.innerHTML = entry.value.match(RegExp(`0*${form.base2}`)) ? "Vrai" : "Faux"
                    }
                    if (event.target.type == "button") {
                        const label = event.target.parentNode.parentNode
                        const form = label.parentNode
                        const bits = Array.from(form.base2);
                        while (bits.length < 8) {bits.unshift('0')}
                        const deci = bits.map((bit, i) => bit == "0" ? "" : Math.pow(2, 7-i));
                        label.innerHTML = `
                            <div class="soustractions">${soustractions(form.base10, 7)}</div>
                            <table>
                                <tr><td>2<sup>7</sup></td><td>2<sup>6</sup></td><td>2<sup>5</sup></td><td>2<sup>4</sup></td><td>2<sup>3</sup></td><td>2<sup>2</sup></td><td>2<sup>1</sup></td><td>2<sup>0</sup></td></tr>
                                <tr><td>128</td><td>64</td><td>32</td><td>16</td><td>8</td><td>4</td><td>2</td><td>1</td></tr>
                                <tr><td>${bits.join("</td><td>")}</td></tr>
                            </table>
                            donc (${form.base10})<sub>10</sub> = (${form.base2})<sub>2</sub>
                        `
                    }
                };
                form.addEventListener("click", form.handleEvent)
                return fieldset;
            },
            () => {
                const fieldset = document.createElement("fieldset");
                const legend = document.createElement("legend");
                const form = document.createElement("form");
                fieldset.appendChild(legend);
                fieldset.appendChild(form);
                legend.textContent = "binaire vers décimal";
                form.base10 = Math.floor(5 + Math.random() * Math.floor(250));
                form.base2 = form.base10.toString(2) ;
                form.sujet = `Convertir en base 10 l'entier naturel (${form.base2})<sub>2</sub> écrit en base 2.`
                form.innerHTML = `
                    <label name="question">${form.sujet}</label>
                    <input type="number" name="rep"></input>
                    <input type="submit" value="Vérifier"/>
                    <label></label>
                    <div class="correction" name="correction"><span class="aDroite"><input type="button" value="Correction"/></span></div>
                `;
                form.handleEvent = (event) => {
                    if (event.target.type == "submit") {
                        event.preventDefault()
                        const entry = event.target.previousElementSibling
                        const label = event.target.nextElementSibling
                        const form = entry.parentNode
                        label.innerHTML = (entry.value == form.base10) ? "Vrai" : "Faux"
                    }
                    if (event.target.type == "button") {
                        const label = event.target.parentNode.parentNode
                        const form = label.parentNode
                        const bits = Array.from(form.base2);
                        while (bits.length < 8) {bits.unshift('0')}
                        const deci = bits.map((bit, i) => bit == "0" ? "" : Math.pow(2, 7-i));
                        label.innerHTML = `
                            <table>
                                <tr><td>${bits.join("</td><td>")}</td></tr>
                                <tr><td>2<sup>7</sup></td><td>2<sup>6</sup></td><td>2<sup>5</sup></td><td>2<sup>4</sup></td><td>2<sup>3</sup></td><td>2<sup>2</sup></td><td>2<sup>1</sup></td><td>2<sup>0</sup></td></tr>
                                <tr><td>128</td><td>64</td><td>32</td><td>16</td><td>8</td><td>4</td><td>2</td><td>1</td></tr>
                                <tr><td>${deci.join("</td><td>")}</td></tr>
                            </table>
                            ${deci.filter(dec => dec != "").join(" + ")} = ${form.base10} <br/>
                            donc (${form.base2})<sub>2</sub> = (${form.base10})<sub>10</sub>
                        `
                    }
                };
                form.addEventListener("click", form.handleEvent)
                return fieldset;
            },
        ]
        liste_questions.forEach(fieldset => {container.appendChild(fieldset())})
    </script>
</body>
</html>
